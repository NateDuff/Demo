trigger:
- main
- development
- feature*

pool:
  vmImage: 'ubuntu-latest'

stages:
  - stage: Build
    jobs:
      - job: buildApp
        displayName: Build Application
        steps:
          - powershell: | 
              Write-Host "Build application step"
            displayName: Run Build Application Script

  - stage: Promotion
    jobs:
      - job: promotion
        displayName: Release Promotion
        steps:
          - checkout: self
          - powershell: | 
              Write-Host "Stage promotion"

              git checkout $(Build.SourceBranchName)

              git clone --mirror https://$env:SYSTEM_ACCESSTOKEN@dev.azure.com/NateDuff/Duff%20Blog/_git/Demo .

              git remote add GHorigin https://github.com/NateDuff/Demo.git

              git push --mirror https://$(GHPAT)@github.com/NateDuff/Demo.git
            displayName: Promotion Script
            env:
              SYSTEM_ACCESSTOKEN: $(System.AccessToken)
          - task: GitHubRelease@1  
            displayName: Create GitHub Release  
            inputs:  
              gitHubConnection: MyGitHubServiceConnection  
              tagSource: userSpecifiedTag  
              tag: '$(Build.BuildNumber)'  
              title: '$(Build.BuildNumber)'  
              assets: '**/*.md'  
              changeLogCompareToRelease: lastNonDraftRelease 